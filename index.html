<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { TrendingUp, TrendingDown, Plus, X, RefreshCw } = lucide;

        const StockCryptoTracker = () => {
            const [holdings, setHoldings] = useState(() => {
                const saved = localStorage.getItem('portfolio-holdings');
                return saved ? JSON.parse(saved) : [
                    { symbol: 'UNH', quantity: 0, type: 'stock' },
                    { symbol: 'GOOG', quantity: 0, type: 'stock' },
                    { symbol: 'AMD', quantity: 0, type: 'stock' }
                ];
            });
            const [prices, setPrices] = useState({});
            const [loading, setLoading] = useState(false);
            const [showAddModal, setShowAddModal] = useState(false);
            const [newSymbol, setNewSymbol] = useState('');
            const [newQuantity, setNewQuantity] = useState('');
            const [newType, setNewType] = useState('stock');
            const [editingIndex, setEditingIndex] = useState(null);
            const [editQuantity, setEditQuantity] = useState('');

            useEffect(() => {
                localStorage.setItem('portfolio-holdings', JSON.stringify(holdings));
            }, [holdings]);

            const fetchPrices = async () => {
                setLoading(true);
                const newPrices = {};
                
                for (const holding of holdings) {
                    try {
                        const symbol = holding.type === 'crypto' ? `${holding.symbol}USD` : holding.symbol;
                        const response = await fetch(
                            `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=1d`
                        );
                        const data = await response.json();
                        
                        if (data.chart?.result?.[0]) {
                            const result = data.chart.result[0];
                            const meta = result.meta;
                            const current = meta.regularMarketPrice;
                            const previous = meta.chartPreviousClose;
                            const change = current - previous;
                            const changePercent = (change / previous) * 100;
                            
                            newPrices[holding.symbol] = {
                                current: current.toFixed(2),
                                change: change.toFixed(2),
                                changePercent: changePercent.toFixed(2)
                            };
                        }
                    } catch (error) {
                        console.error(`Error fetching ${holding.symbol}:`, error);
                        newPrices[holding.symbol] = {
                            current: '0.00',
                            change: '0.00',
                            changePercent: '0.00',
                            error: true
                        };
                    }
                }
                
                setPrices(newPrices);
                setLoading(false);
            };

            useEffect(() => {
                fetchPrices();
                const interval = setInterval(fetchPrices, 60000);
                return () => clearInterval(interval);
            }, [holdings]);

            const addHolding = () => {
                if (newSymbol.trim()) {
                    setHoldings([...holdings, {
                        symbol: newSymbol.toUpperCase().trim(),
                        quantity: parseFloat(newQuantity) || 0,
                        type: newType
                    }]);
                    setNewSymbol('');
                    setNewQuantity('');
                    setShowAddModal(false);
                }
            };

            const removeHolding = (index) => {
                setHoldings(holdings.filter((_, i) => i !== index));
            };

            const updateQuantity = (index, quantity) => {
                const updated = [...holdings];
                updated[index].quantity = parseFloat(quantity) || 0;
                setHoldings(updated);
                setEditingIndex(null);
                setEditQuantity('');
            };

            const getTotalValue = () => {
                return holdings.reduce((total, holding) => {
                    const price = parseFloat(prices[holding.symbol]?.current || 0);
                    return total + (price * holding.quantity);
                }, 0);
            };

            const getTotalChange = () => {
                return holdings.reduce((total, holding) => {
                    const change = parseFloat(prices[holding.symbol]?.change || 0);
                    return total + (change * holding.quantity);
                }, 0);
            };

            const totalValue = getTotalValue();
            const totalChange = getTotalChange();
            const totalChangePercent = totalValue > 0 ? (totalChange / (totalValue - totalChange)) * 100 : 0;

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4 pb-20">
                    <div className="max-w-2xl mx-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h1 className="text-3xl font-bold">Portfolio</h1>
                            <button
                                onClick={fetchPrices}
                                disabled={loading}
                                className="p-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition-colors"
                            >
                                <RefreshCw className={`w-5 h-5 ${loading ? 'animate-spin' : ''}`} />
                            </button>
                        </div>

                        <div className="bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl p-6 mb-6 shadow-xl">
                            <div className="text-blue-100 text-sm mb-1">Total Portfolio Value</div>
                            <div className="text-4xl font-bold mb-2">
                                ${totalValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                            </div>
                            <div className={`flex items-center gap-2 text-lg ${totalChange >= 0 ? 'text-green-300' : 'text-red-300'}`}>
                                {totalChange >= 0 ? <TrendingUp className="w-5 h-5" /> : <TrendingDown className="w-5 h-5" />}
                                <span className="font-semibold">
                                    {totalChange >= 0 ? '+' : ''}{totalChange.toFixed(2)} ({totalChangePercent >= 0 ? '+' : ''}{totalChangePercent.toFixed(2)}%)
                                </span>
                                <span className="text-blue-200 text-sm">today</span>
                            </div>
                        </div>

                        <div className="space-y-3 mb-20">
                            {holdings.map((holding, index) => {
                                const priceData = prices[holding.symbol] || {};
                                const isPositive = parseFloat(priceData.change) >= 0;
                                const holdingValue = parseFloat(priceData.current || 0) * holding.quantity;
                                
                                return (
                                    <div key={index} className="bg-slate-800 rounded-xl p-4 shadow-lg hover:shadow-xl transition-shadow">
                                        <div className="flex justify-between items-start mb-3">
                                            <div>
                                                <div className="flex items-center gap-2">
                                                    <h3 className="text-xl font-bold">{holding.symbol}</h3>
                                                    <span className="text-xs px-2 py-1 rounded-full bg-slate-700 text-slate-300">
                                                        {holding.type}
                                                    </span>
                                                </div>
                                                <div className="text-sm text-slate-400 mt-1">
                                                    {holding.quantity > 0 ? `${holding.quantity} shares` : 'No shares held'}
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => removeHolding(index)}
                                                className="p-1 hover:bg-slate-700 rounded-lg transition-colors"
                                            >
                                                <X className="w-4 h-4 text-slate-400" />
                                            </button>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <div className="text-slate-400 text-xs mb-1">Current Price</div>
                                                <div className="text-2xl font-bold">
                                                    ${priceData.current || 'â€”'}
                                                </div>
                                                <div className={`flex items-center gap-1 mt-1 text-sm ${isPositive ? 'text-green-400' : 'text-red-400'}`}>
                                                    {isPositive ? <TrendingUp className="w-4 h-4" /> : <TrendingDown className="w-4 h-4" />}
                                                    <span>
                                                        {isPositive ? '+' : ''}{priceData.change || '0.00'} ({isPositive ? '+' : ''}{priceData.changePercent || '0.00'}%)
                                                    </span>
                                                </div>
                                            </div>

                                            <div>
                                                <div className="text-slate-400 text-xs mb-1">Position Value</div>
                                                {editingIndex === index ? (
                                                    <input
                                                        type="number"
                                                        value={editQuantity}
                                                        onChange={(e) => setEditQuantity(e.target.value)}
                                                        onBlur={() => updateQuantity(index, editQuantity)}
                                                        onKeyPress={(e) => e.key === 'Enter' && updateQuantity(index, editQuantity)}
                                                        className="w-full bg-slate-700 rounded px-2 py-1 text-sm"
                                                        placeholder="Quantity"
                                                        autoFocus
                                                    />
                                                ) : (
                                                    <>
                                                        <div className="text-2xl font-bold">
                                                            ${holdingValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                                                        </div>
                                                        <button
                                                            onClick={() => {
                                                                setEditingIndex(index);
                                                                setEditQuantity(holding.quantity.toString());
                                                            }}
                                                            className="text-xs text-blue-400 hover:text-blue-300 mt-1"
                                                        >
                                                            Edit quantity
                                                        </button>
                                                    </>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        <button
                            onClick={() => setShowAddModal(true)}
                            className="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white rounded-full p-4 shadow-2xl transition-colors"
                        >
                            <Plus className="w-6 h-6" />
                        </button>

                        {showAddModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl">
                                    <h2 className="text-2xl font-bold mb-4">Add New Holding</h2>
                                    
                                    <div className="mb-4">
                                        <label className="block text-sm text-slate-400 mb-2">Type</label>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => setNewType('stock')}
                                                className={`flex-1 py-2 rounded-lg transition-colors ${
                                                    newType === 'stock' ? 'bg-blue-600' : 'bg-slate-700'
                                                }`}
                                            >
                                                Stock
                                            </button>
                                            <button
                                                onClick={() => setNewType('crypto')}
                                                className={`flex-1 py-2 rounded-lg transition-colors ${
                                                    newType === 'crypto' ? 'bg-blue-600' : 'bg-slate-700'
                                                }`}
                                            >
                                                Crypto
                                            </button>
                                        </div>
                                    </div>

                                    <div className="mb-4">
                                        <label className="block text-sm text-slate-400 mb-2">
                                            Symbol {newType === 'crypto' && '(e.g., BTC, ETH)'}
                                        </label>
                                        <input
                                            type="text"
                                            value={newSymbol}
                                            onChange={(e) => setNewSymbol(e.target.value)}
                                            className="w-full bg-slate-700 rounded-lg px-4 py-2 text-white"
                                            placeholder="AAPL"
                                        />
                                    </div>

                                    <div className="mb-6">
                                        <label className="block text-sm text-slate-400 mb-2">Quantity</label>
                                        <input
                                            type="number"
                                            value={newQuantity}
                                            onChange={(e) => setNewQuantity(e.target.value)}
                                            className="w-full bg-slate-700 rounded-lg px-4 py-2 text-white"
                                            placeholder="0"
                                            step="0.01"
                                        />
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => {
                                                setShowAddModal(false);
                                                setNewSymbol('');
                                                setNewQuantity('');
                                            }}
                                            className="flex-1 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={addHolding}
                                            className="flex-1 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 transition-colors"
                                        >
                                            Add
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<StockCryptoTracker />, document.getElementById('root'));
    </script>
</body>
</html>
